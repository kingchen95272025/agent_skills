# 阶段一：需求理解阶段详细指南

## 阶段目标

深度理解用户需求，明确要生成的界面功能和范围。

## 输入条件

用户提供以下任一输入：
- 功能描述（简单描述或详细说明）
- PRD markdown文档

## 页面生成原则

1. 如果需要生成一组多个页面
    - 必须有一个index.html文件，作为主页面串联所有页面。
    - 每个页面必须有独立的HTML文件。
    - 所有页面必须使用相同的UI模板风格。
    - 注意多个页面之间的跳转。
    - 多个页面必须逻辑闭环，支持点击页面内的按钮或链接跳转到其他页面。

## 执行步骤

### 步骤1：识别输入类型

**判断标准**：
- 如果用户提供了markdown文件或包含明显文档结构的内容 → PRD文档
- 如果用户简单描述功能（如"供应商列表页"） → 功能描述

**处理方式**：
- **PRD文档**：先通读全文，重点关注【功能需求详述与界面设计】章节
- **功能描述**：直接进入需求提取

### 步骤2：需求提取和分析

#### 2.1 提取核心功能模块

识别页面的核心功能模块，常见的B端供应链功能模块包括：

**数据展示类**：
- 数据列表/表格
- 统计卡片/仪表板
- 数据详情

**数据操作类**：
- 新增/创建
- 编辑/修改
- 删除
- 批量操作

**数据筛选类**：
- 搜索
- 筛选条件
- 排序
- 分页

**业务流程类**：
- 审批流程
- 状态流转
- 导入导出

#### 2.2 识别页面类型

确定需要生成哪些类型的页面：

- **列表页**：展示数据列表，包含筛选、搜索、分页等功能
- **详情页**：展示单条数据的详细信息
- **表单页**：新增或编辑数据的表单页面
- **仪表板页**：统计数据和图表展示

#### 2.3 识别数据字段和结构

提取关键的数据字段：
- 字段名称
- 字段类型（文本、数字、日期、枚举等）
- 是否必填
- 字段说明

示例：
```javascript
{
  order_no: "订单编号（文本，必填）",
  supplier: "供应商（枚举，必填）",
  total_amount: "订单金额（数字）",
  status: "状态（枚举：draft/pending/approved等）",
  apply_date: "申请日期（日期）"
}
```

#### 2.4 识别交互要求

明确需要的交互功能：

**基础交互**：
- 页面加载和数据渲染
- 响应式布局

**筛选交互**：
- 搜索框
- 下拉筛选
- 日期筛选
- 清除筛选

**CRUD交互**：
- 新增数据（打开模态框，填写表单，提交）
- 编辑数据（打开模态框，填充数据，修改，提交）
- 查看详情（打开模态框或跳转详情页）
- 删除数据（确认对话框，删除）
- 批量操作（批量选择，批量删除/审批等）

**表单交互**：
- 表单验证（必填项、格式校验）
- 表单提交
- 错误提示

**状态管理**：
- 状态切换
- 状态标签显示

**其他交互**：
- 导入导出
- 打印
- 消息提示
- 加载动画

### 步骤3：需求确认（交互式梳理）

**重要**：这是本阶段的核心步骤，必须与用户充分交互。

#### 3.1 逐条确认需求理解

不要一次性抛出所有问题，而是分组、有序地确认：

**第一轮确认：页面范围**
```
"根据我的理解，这个功能需要生成以下页面：
1. [页面1名称] - [简要说明]
2. [页面2名称] - [简要说明]
3. ...

这样理解对吗？还是只需要生成其中的某些页面？"
```

**第二轮确认：核心功能**
```
"对于[页面名称]，我理解的核心功能包括：
- [功能1]
- [功能2]
- [功能3]

这些功能完整吗？有遗漏或不需要的吗？"
```

**第三轮确认：数据字段**
```
"我提取到以下关键数据字段：
- [字段1]：[类型]、[说明]
- [字段2]：[类型]、[说明]
- ...

这些字段准确吗？有需要补充或修改的吗？"
```

**第四轮确认：特殊要求**
```
"关于交互和显示，有以下特殊要求吗？
- 是否需要批量操作？
- 是否需要导入导出功能？
- 是否需要审批流程？
- 数据是否有状态流转？
- 其他特殊要求？"
```

#### 3.2 询问不明确的地方

如果PRD或功能描述中有模糊的地方，主动询问：

- "PRD中提到'订单管理'，具体是指哪些功能呢？"
- "状态流转的具体规则是什么？"
- "筛选条件有哪些？"
- "表单验证规则是什么？"

#### 3.3 确认页面拆分方案

```
"关于页面拆分，我建议：
- [方案1]：单页面实现所有功能（列表+表单都在一个HTML中）
- [方案2]：多页面实现（列表页、详情页、表单页分开）

您更倾向于哪种方式？或者有其他建议？"
```

### 步骤4：生成需求理解文档

创建 `.claude/ui-generator/{功能名}/input.md` 文件，包含以下内容：

```markdown
# 需求理解文档

## 一、功能概述

[简要描述整体功能]

## 二、页面清单

### 页面1：[页面名称]
- **页面类型**：列表页/详情页/表单页/仪表板
- **核心功能**：[列出核心功能]
- **URL/文件名**：[建议的文件名]

### 页面2：[页面名称]
...

## 三、数据字段定义

### 主要实体：[实体名称]

| 字段名 | 字段说明 | 数据类型 | 是否必填 | 备注 |
|--------|----------|----------|----------|------|
| order_no | 订单编号 | String | 是 | 唯一标识 |
| supplier | 供应商 | Enum | 是 | 下拉选择 |
| ... | ... | ... | ... | ... |

## 四、功能模块清单

### 4.1 数据展示
- [ ] 数据列表/表格
- [ ] 统计卡片
- [ ] 数据详情

### 4.2 数据筛选
- [ ] 搜索框（字段：[字段名]）
- [ ] 筛选条件（字段：[字段名]）
- [ ] 分页
- [ ] 排序

### 4.3 CRUD操作
- [ ] 新增数据
- [ ] 编辑数据
- [ ] 查看详情
- [ ] 删除数据
- [ ] 批量操作（具体：[批量删除/批量审批等]）

### 4.4 特殊功能
- [ ] 导入数据
- [ ] 导出数据
- [ ] 状态流转（状态：[列出所有状态]）
- [ ] 审批流程
- [ ] 其他：[具体说明]

## 五、交互要求

### 5.1 表单验证
- [字段名]：[验证规则]
- [字段名]：[验证规则]

### 5.2 状态管理
- 状态列表：[draft/pending/approved等]
- 状态流转规则：[说明]

### 5.3 提示和反馈
- 成功提示：[示例]
- 错误提示：[示例]
- 确认对话框：[什么操作需要确认]

## 六、特殊说明

[记录任何特殊要求、约束或注意事项]

## 七、用户确认记录

- ✅ 页面范围已确认
- ✅ 核心功能已确认
- ✅ 数据字段已确认
- ✅ 特殊要求已确认
```

## 输出成果

- 创建 `.claude/ui-generator/{功能名}/input.md` 文件
- 功能名使用kebab-case格式（如"purchase-order"、"supplier-management"）

## 完成标准

必须满足以下所有条件才能进入下一阶段：

- ✅ 明确了解要生成几个HTML文件
- ✅ 清楚每个页面的核心功能
- ✅ 明确了数据字段和结构
- ✅ 用户确认需求理解准确
- ✅ 已创建需求理解文档（input.md）

## 评估维度

- **需求理解准确性（40%）**：是否准确理解用户意图
- **需求完整性（40%）**：是否遗漏关键功能
- **沟通有效性（20%）**：交互式梳理是否有效解决了疑问

## 常见问题处理

### Q1：用户提供的描述非常简单怎么办？

主动提问，帮助用户细化需求：
```
"您提到需要'供应商列表页'，让我帮您梳理一下具体需求：
1. 这个页面需要展示哪些供应商信息？（名称、联系方式、合作状态等）
2. 需要哪些筛选条件？（按名称搜索、按状态筛选等）
3. 需要哪些操作？（新增、编辑、删除、查看详情等）
4. 是否需要批量操作？
5. 是否需要导入导出功能？"
```

### Q2：PRD文档太长，如何高效处理？

1. 先速读全文，把握整体结构
2. 重点关注【功能需求详述与界面设计】章节
3. 提取关键信息（页面、功能、字段、交互）
4. 与用户确认是否需要实现所有PRD中的功能

### Q3：用户需求前后矛盾怎么办？

主动指出矛盾，帮助用户澄清：
```
"我注意到在需求描述中，第3点提到'只显示审批通过的订单'，
但在筛选条件中又包含'所有状态'的筛选选项。
请问是：
A) 默认只显示审批通过的，但可以通过筛选查看其他状态
B) 应该去掉状态筛选，始终只显示审批通过的
您的意图是哪种呢？"
```

### Q4：用户说"参考某个现有系统"怎么办？

如果无法访问该系统，请用户提供：
- 系统截图
- 功能描述文档
- 或者描述具体想要参考的功能点

## 注意事项

1. **不要假设**：不确定的地方一定要问清楚，不要根据经验假设
2. **不要遗漏**：即使是看似简单的功能，也要确认完整的功能清单
3. **不要跳过确认**：必须与用户交互式确认，不能自己理解了就直接进入下一阶段
4. **保持专业**：即使用户的需求有不合理之处，也要专业地指出并提供建议
5. **记录详细**：所有确认的内容都要详细记录在input.md中

## 示例场景

### 示例1：处理简单功能描述

**用户输入**："生成一个采购订单列表页面"

**处理过程**：
```
我：好的！让我帮您生成采购订单列表页面。首先让我了解一下具体需求：

1. 关于展示的订单信息，您需要显示哪些字段呢？
   - 订单编号
   - 供应商
   - 申请部门
   - 订单金额
   - 订单状态
   - 申请日期
   - 其他字段？

2. 关于筛选功能，需要哪些筛选条件？
   - 按订单编号搜索
   - 按供应商筛选
   - 按状态筛选
   - 按日期范围筛选
   - 其他？

3. 关于操作功能，需要哪些操作？
   - 新增订单
   - 编辑订单
   - 查看订单详情
   - 删除订单
   - 批量操作（批量审批、批量删除等）
   - 导入导出
   - 其他？

4. 这个页面是单独一个HTML文件（所有功能都在一个页面），
   还是需要拆分成多个HTML文件（列表页、详情页、新增/编辑页）？

请您详细说明一下这些需求，我会据此生成完整的原型。
```

### 示例2：处理PRD文档

**用户输入**：[附上PRD文档]

**处理过程**：
```
我：收到PRD文档，让我先通读一遍...

（阅读PRD后）

好的，我已经通读了PRD文档。根据【功能需求详述与界面设计】章节，
我理解需要生成以下页面和功能：

**页面清单**：
1. 采购订单列表页
2. 订单详情页
3. 新增/编辑订单页

**核心功能**：
1. 订单列表展示（包含筛选、搜索、分页）
2. CRUD操作（新增、编辑、查看、删除）
3. 批量审批功能
4. 订单导入导出

**关键数据字段**：
（列出提取到的所有字段）

**状态流转**：
草稿 → 待审批 → 审批通过/审批拒绝/退回修改

以上理解正确吗？有需要补充或修改的地方吗？
```

## 推进到下一阶段

完成本阶段后，使用以下方式确认推进：

```
"需求理解文档已生成，我已经明确了：
- 需要生成 [N] 个HTML页面
- 每个页面的核心功能
- 所有数据字段和结构
- 特殊的交互要求

需求理解准确吗？如果确认无误，我们可以进入界面规划阶段，
开始设计页面布局和交互流程。"
```
