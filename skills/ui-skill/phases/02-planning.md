# 阶段二：界面规划阶段详细指南

## 阶段目标

规划详细的页面布局、功能模块分布和交互流程。

## 输入条件

- 需求理解文档（`input.md`）已完成
- 用户已确认需求理解准确

## 页面生成原则

1. 如果需要生成一组多个页面
    - 必须有一个index.html文件，作为主页面串联所有页面。
    - 每个页面必须有独立的HTML文件。
    - 所有页面必须使用相同的UI模板风格。
    - 注意多个页面之间的跳转。
    - 多个页面必须逻辑闭环，支持点击页面内的按钮或链接跳转到其他页面。

## 执行步骤

### 步骤1：页面布局规划

为每个页面设计布局结构。

#### 1.1 常见的B端页面布局模式

**列表页标准布局**：
```
┌─────────────────────────────────────┐
│  面包屑导航                           │
├─────────────────────────────────────┤
│  统计卡片区（可选）                   │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐      │
│  │卡片│ │卡片│ │卡片│ │卡片│      │
│  └────┘ └────┘ └────┘ └────┘      │
├─────────────────────────────────────┤
│  筛选搜索区                           │
│  ┌────────────────────────────────┐ │
│  │ [搜索框] [筛选] [筛选] [按钮]  │ │
│  │ [操作按钮组]                   │ │
│  └────────────────────────────────┘ │
├─────────────────────────────────────┤
│  数据表格区                           │
│  ┌────────────────────────────────┐ │
│  │ 表头                           │ │
│  ├────────────────────────────────┤ │
│  │ 数据行1                        │ │
│  │ 数据行2                        │ │
│  │ ...                            │ │
│  └────────────────────────────────┘ │
├─────────────────────────────────────┤
│  分页区                               │
│  ┌────────────────────────────────┐ │
│  │           [分页组件]           │ │
│  └────────────────────────────────┘ │
└─────────────────────────────────────┘
```

**表单页标准布局**：
```
┌─────────────────────────────────────┐
│  面包屑导航                           │
├─────────────────────────────────────┤
│  表单区                               │
│  ┌────────────────────────────────┐ │
│  │ == 基本信息 ==                 │ │
│  │ [字段1] [字段2]                │ │
│  │ [字段3] [字段4]                │ │
│  ├────────────────────────────────┤ │
│  │ == 详细信息 ==                 │ │
│  │ [字段5] [字段6]                │ │
│  │ [文本域]                       │ │
│  ├────────────────────────────────┤ │
│  │        [取消] [提交]           │ │
│  └────────────────────────────────┘ │
└─────────────────────────────────────┘
```

**详情页标准布局**：
```
┌─────────────────────────────────────┐
│  面包屑导航                           │
├─────────────────────────────────────┤
│  详情信息区                           │
│  ┌────────────────────────────────┐ │
│  │ == 基本信息 ==                 │ │
│  │ 字段1: 值1    字段2: 值2       │ │
│  │ 字段3: 值3    字段4: 值4       │ │
│  ├────────────────────────────────┤ │
│  │ == 明细信息 ==                 │ │
│  │ [表格或列表]                   │ │
│  ├────────────────────────────────┤ │
│  │ == 操作记录 ==                 │ │
│  │ [时间线或列表]                 │ │
│  │                                │ │
│  │      [返回] [编辑] [其他操作]  │ │
│  └────────────────────────────────┘ │
└─────────────────────────────────────┘
```

#### 1.2 定义页面栅格系统

使用响应式栅格系统：
- **桌面端（>1200px）**：最大宽度1200px，居中显示
- **平板端（768px-1200px）**：自适应宽度，内边距减小
- **移动端（<768px）**：单列布局，表格横向滚动

#### 1.3 确定关键元素的位置和大小

为每个页面的关键元素规划：
- 统计卡片：高度、列数、间距
- 筛选区：布局方式（行内/垂直）、输入框宽度
- 表格：列宽、行高、最大高度
- 按钮：大小、间距、对齐方式
- 模态框：宽度、最大高度

### 步骤2：功能模块规划

#### 2.1 统计卡片（如果需要）

**适用场景**：
- 仪表板页面
- 列表页顶部展示关键指标

**卡片内容**：
- 标题（如"待处理订单"）
- 数值（如"12"）
- 辅助说明（如"需要审批的订单"）
- 趋势指示器（可选，如"+12.5%"）

**设计要点**：
- 数量：通常2-6个
- 布局：响应式网格，自动适应
- 样式：卡片阴影、左侧色条、图标等

#### 2.2 筛选搜索区域

**常见筛选组件**：
- 文本搜索框
- 下拉选择器（单选/多选）
- 日期选择器（单日/范围）
- 级联选择器
- 快捷筛选标签

**布局方式**：
- **行内布局**（推荐）：筛选条件在同一行，自动换行
- **垂直布局**：筛选条件垂直排列，适合筛选项较多的场景

**操作按钮**：
- 搜索/查询按钮
- 清除/重置按钮
- 高级筛选展开按钮（可选）

#### 2.3 数据展示区

**表格设计**：
```markdown
| 列名 | 宽度 | 对齐方式 | 说明 |
|------|------|----------|------|
| 选择框 | 50px | 居中 | 批量选择 |
| 订单编号 | 120px | 左对齐 | 主键字段 |
| 供应商名称 | 150px | 左对齐 | 文本字段 |
| 订单金额 | 100px | 右对齐 | 数字字段 |
| 状态 | 100px | 居中 | 状态标签 |
| 操作 | 160px | 居中 | 操作按钮 |
```

**表格特性**：
- 固定表头（滚动时表头不动）
- 行悬停高亮
- 斑马纹（可选）
- 空状态提示

**卡片/列表设计**（备选）：
适用于字段较少或需要展示更多信息的场景。

#### 2.4 操作按钮区

**主要操作**（通常在筛选区下方）：
- 新建/新增按钮（主按钮样式）
- 批量操作按钮（删除、审批等）
- 导入/导出按钮
- 其他业务操作

**行内操作**（在表格每行的操作列）：
- 查看/详情
- 编辑
- 删除
- 其他业务操作（审批、提交等）

**按钮设计原则**：
- 主要操作使用主按钮样式
- 危险操作（删除）使用警告样式
- 操作按钮不超过5个，多余的放入"更多"下拉菜单

#### 2.5 模态框（Modal）

**新增/编辑模态框**：
```
宽度：600px-900px（根据表单复杂度）
结构：
- 头部：标题 + 关闭按钮
- 主体：表单内容（分组展示）
- 底部：取消 + 确定按钮
```

**查看详情模态框**：
```
宽度：800px-1000px
结构：
- 头部：标题 + 关闭按钮
- 主体：详情信息（分组展示）
- 底部：关闭 + 编辑按钮（可选）
```

**确认对话框**：
```
宽度：400px-500px
结构：
- 头部：警告标题
- 主体：确认提示内容
- 底部：取消 + 确定按钮
```

**导入模态框**：
```
宽度：600px
结构：
- 文件上传区
- 模板下载链接
- 导入结果展示区
- 失败结果下载链接
```

#### 2.6 分页组件

**分页信息**：
- 总条数
- 当前页/总页数
- 每页显示条数（可选）

**分页操作**：
- 首页/末页
- 上一页/下一页
- 页码按钮（通常显示5-7个页码）

### 步骤3：交互流程设计

#### 3.1 数据加载流程

```
页面加载
  ↓
显示加载动画
  ↓
加载模拟数据
  ↓
渲染页面内容
  ↓
隐藏加载动画
```

#### 3.2 CRUD操作流程

**新增流程**：
```
点击"新增"按钮
  ↓
打开新增模态框
  ↓
生成自动字段（如订单编号）
  ↓
用户填写表单
  ↓
点击"保存"按钮
  ↓
表单验证
  ├─失败→ 显示错误提示，停留在表单
  └─成功
      ↓
    显示加载状态
      ↓
    模拟保存数据
      ↓
    关闭模态框
      ↓
    刷新列表
      ↓
    显示成功提示
```

**编辑流程**：
```
点击"编辑"按钮
  ↓
打开编辑模态框
  ↓
填充现有数据
  ↓
用户修改表单
  ↓
点击"保存"按钮
  ↓
表单验证
  ├─失败→ 显示错误提示
  └─成功
      ↓
    更新数据
      ↓
    关闭模态框
      ↓
    刷新列表
      ↓
    显示成功提示
```

**删除流程**：
```
点击"删除"按钮
  ↓
显示确认对话框
  ├─取消→ 关闭对话框
  └─确定
      ↓
    删除数据
      ↓
    刷新列表
      ↓
    显示成功提示
```

**查看详情流程**：
```
点击"查看"按钮
  ↓
打开详情模态框
  ↓
展示完整数据
  ↓
用户查看
  ↓
关闭模态框
```

#### 3.3 表单验证逻辑

**验证时机**：
- 失焦验证（字段失去焦点时）
- 提交验证（点击提交按钮时）

**验证规则**：
```javascript
{
  order_no: {
    required: true,
    message: "订单编号不能为空"
  },
  supplier: {
    required: true,
    message: "请选择供应商"
  },
  total_amount: {
    required: true,
    type: "number",
    min: 0,
    message: "订单金额必须大于0"
  },
  email: {
    pattern: /^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/,
    message: "邮箱格式不正确"
  }
}
```

**错误显示**：
- 输入框边框变红
- 输入框下方显示错误提示文字
- 提交时滚动到第一个错误字段

#### 3.4 状态切换逻辑

如果有状态管理，设计状态流转规则：

```
草稿(draft)
  ↓ [提交]
待审批(pending)
  ↓ [审批]
  ├→ 审批通过(approved)
  ├→ 审批拒绝(rejected)
  └→ 退回修改(returned) → 重新提交 → 待审批
```

**状态标签样式**：
- 草稿：绿色
- 待审批：橙色
- 审批通过：绿色
- 审批拒绝：红色
- 退回修改：橙色

#### 3.5 错误处理和提示

**成功提示**：
```
类型：绿色消息框
位置：页面顶部居中
内容："操作成功！"
自动关闭：3秒
```

**错误提示**：
```
类型：红色消息框
位置：页面顶部居中
内容："操作失败：[具体原因]"
自动关闭：5秒或手动关闭
```

**警告提示**：
```
类型：橙色消息框
内容："您确定要[操作]吗？此操作不可撤销。"
按钮：取消 / 确定
```

### 步骤4：数据结构设计

#### 4.1 模拟数据（mockData）结构

基于需求理解文档中的数据字段，设计完整的模拟数据：

```javascript
const mockData = [
  {
    id: 1,
    order_no: "PO20241225001",
    supplier: "科技创新有限公司",
    department: "研发部",
    applicant: "张三",
    apply_date: "2024-12-25",
    expected_date: "2025-01-15",
    total_amount: 156000.00,
    status: "pending",
    priority: "high",
    items: [
      {
        name: "服务器设备",
        quantity: 2,
        unit_price: 65000,
        amount: 130000
      },
      {
        name: "网络设备",
        quantity: 5,
        unit_price: 5200,
        amount: 26000
      }
    ],
    remark: "紧急采购，用于新项目开发"
  },
  // ... 更多数据
];
```

**设计原则**：
- 数据量：5-10条（足够展示功能，不会太多）
- 数据多样性：覆盖各种状态、各种数值范围
- 数据真实性：符合业务场景的合理数据

#### 4.2 表单字段定义

```javascript
const formFields = {
  order_no: {
    label: "订单编号",
    type: "text",
    required: true,
    readonly: true,  // 自动生成
    placeholder: "自动生成"
  },
  supplier: {
    label: "供应商",
    type: "select",
    required: true,
    options: [
      { value: "科技创新有限公司", label: "科技创新有限公司" },
      { value: "硬件制造集团", label: "硬件制造集团" },
      // ...
    ]
  },
  total_amount: {
    label: "订单金额",
    type: "number",
    required: true,
    min: 0,
    step: 0.01,
    placeholder: "0.00"
  },
  // ...
};
```

#### 4.3 状态枚举定义

```javascript
const statusEnum = {
  draft: { label: "草稿", color: "green", class: "status-draft" },
  pending: { label: "待审批", color: "orange", class: "status-pending" },
  approved: { label: "审批通过", color: "green", class: "status-approved" },
  rejected: { label: "审批拒绝", color: "red", class: "status-rejected" },
  returned: { label: "退回修改", color: "orange", class: "status-returned" }
};
```

### 步骤5：生成界面规划文档

创建 `.claude/ui-generator/{功能名}/ui_plan.md` 文件，详细记录所有规划内容。

**文档模板**：
```markdown
# 界面规划文档

## 一、页面布局规划

### 页面1：[页面名称]

#### 布局结构
[使用ASCII图描述布局]

#### 栅格系统
- 桌面端：最大宽度1200px
- 平板端：自适应
- 移动端：单列布局

#### 关键元素尺寸
- 统计卡片：高度120px，4列
- 筛选区：行内布局，自动换行
- 表格：最大高度600px，固定表头
- 模态框：宽度900px

### 页面2：[页面名称]
...

## 二、功能模块规划

### 2.1 统计卡片
- 卡片1：待处理订单
- 卡片2：本月订单
- 卡片3：订单总金额
- 卡片4：完成率

### 2.2 筛选搜索区
- 订单编号搜索框
- 供应商选择器
- 部门选择器
- 状态选择器
- 优先级选择器
- 搜索按钮 / 清除按钮

### 2.3 数据表格
[表格列定义表格]

### 2.4 操作按钮区
**主要操作**：
- 新建订单（主按钮）
- 导入数据（主按钮）
- 批量审批（默认按钮）
- 导出数据（默认按钮）
- 批量删除（危险按钮）

**行内操作**：
- 查看
- 编辑
- 删除

### 2.5 模态框
**新增/编辑订单模态框**：
- 宽度：900px
- 表单分组：基本信息、订单明细、备注信息

**订单详情模态框**：
- 宽度：800px
- 内容分组：基本信息、订单明细、备注信息

**批量导入模态框**：
- 宽度：600px
- 功能：文件上传、模板下载、结果展示

### 2.6 分页组件
- 总条数显示
- 首页/末页/上一页/下一页
- 页码按钮（显示5个）

## 三、交互流程设计

### 3.1 页面加载流程
[流程图或步骤描述]

### 3.2 CRUD操作流程
**新增流程**：
[详细步骤]

**编辑流程**：
[详细步骤]

**删除流程**：
[详细步骤]

**查看详情流程**：
[详细步骤]

### 3.3 表单验证逻辑
[验证规则表格]

### 3.4 状态切换逻辑
[状态流转图]

### 3.5 错误处理
[提示规则说明]

## 四、数据结构设计

### 4.1 模拟数据结构
```javascript
[完整的mockData示例]
```

### 4.2 表单字段定义
```javascript
[完整的formFields定义]
```

### 4.3 状态枚举定义
```javascript
[完整的statusEnum定义]
```

## 五、用户确认记录

- ✅ 页面布局已确认
- ✅ 功能模块已确认
- ✅ 交互流程已确认
- ✅ 数据结构已确认
```

## 输出成果

- 创建 `.claude/ui-generator/{功能名}/ui_plan.md` 文件

## 完成标准

- ✅ 每个页面的布局结构清晰
- ✅ 所有功能模块已规划
- ✅ 交互流程完整合理
- ✅ 数据结构明确
- ✅ 用户确认规划方案

## 评估维度

- **布局合理性（30%）**：是否符合B端设计规范
- **功能完整性（30%）**：是否覆盖所有需求
- **交互流畅性（25%）**：用户操作路径是否顺畅
- **数据结构合理性（15%）**：是否易于理解和使用

## 推进到下一阶段

完成本阶段后，使用以下方式确认推进：

```
"界面规划完成了，我为[页面名]设计了[布局描述]，
包含[核心功能模块]，交互流程也已经规划好了。

这个方案看起来怎么样？如果满意，我们可以选择UI模板风格，
然后开始生成代码。"
```
