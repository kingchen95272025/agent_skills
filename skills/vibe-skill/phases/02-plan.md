# 第二阶段：规划 (Plan)

## 触发条件

- 理解阶段完成
- 用户确认需求理解无误
- 准备开始制定实现方案

## 阶段目标

与用户充分沟通实现方案，建立详尽的任务列表，确保双方对任务范围和执行步骤达成一致。

## 我的工作

### 1. 整体方案设计

基于理解阶段收集的信息，设计整体实现方案：

- 确定技术实现路径
- 规划代码分层结构（Model → Repository → Service → Controller → Route）
- 识别需要新增或修改的文件
- 考虑对现有代码的影响

### 2. 方案沟通

向用户清晰说明实现方案：

```markdown
## 实现方案

### 整体思路
[简要说明实现的整体思路]

### 涉及的代码分层
- **Model 层**: [需要新增/修改的模型]
- **Repository 层**: [需要新增/修改的仓储]
- **Service 层**: [需要新增/修改的服务]
- **Controller 层**: [需要新增/修改的控制器]
- **Route**: [需要新增/修改的路由]
- **其他**: [枚举、请求验证、资源转换等]

### 关键设计决策
- [决策1及理由]
- [决策2及理由]

### 对现有代码的影响
- [影响说明]
```

### 3. 建立 To-dos 任务列表

**核心要求**：建立详尽的任务列表，任务编号清晰

任务列表要求：
- 使用层级编号（如 1、1.1、1.1.1）
- 每个任务有明确的目标和边界
- 任务粒度适中，便于执行和追踪
- 按业务模块组织，而非按代码分层

任务格式示例：

```markdown
## To-dos 任务列表

### 1 基础设施准备
- [ ] 1.1 创建数据库迁移文件
  - 创建 xxx 表的迁移脚本
  - 包含所有必要字段和索引
- [ ] 1.2 创建枚举类
  - 状态枚举
  - 类型枚举
  - 包含多语言翻译

### 2 核心业务模块 A
- [ ] 2.1 Model 层开发
  - 创建 XxxModel
  - 定义关联关系
- [ ] 2.2 Repository 层开发
  - 创建 XxxRepository
  - 实现 CRUD 方法
- [ ] 2.3 Service 层开发
  - 创建 XxxService
  - 实现核心业务逻辑
- [ ] 2.4 Controller 层开发
  - 创建 XxxController
  - 实现接口方法
- [ ] 2.5 路由配置
  - 添加 API 路由

### 3 核心业务模块 B
- [ ] 3.1 ...

### 4 收尾工作
- [ ] 4.1 代码自查
  - 检查规范一致性
  - 检查功能完整性
```

### 4. 明确验收标准

为每个主要任务明确验收标准：

- 功能是否符合需求
- 代码是否符合规范
- 是否有遗漏的边缘情况

### 5. 获取用户确认

- 展示完整的方案和任务列表
- 询问用户是否有调整意见
- 获得确认后进入执行阶段

## 重要约束

- **必须和用户沟通方案** - 不能直接开始执行
- **任务列表必须详尽** - 不能模糊或遗漏
- **任务编号必须清晰** - 格式为"编号 + 空格 + 任务描述"
- **必须获得用户确认** - 用户同意后才能进入执行阶段
- **按业务模块组织** - 不要按代码分层组织任务

## 与用户的交互

规划阶段的交互示例：

**方案展示后**：
- "以上是我的实现方案和任务列表，你看看有没有需要调整的地方？"
- "任务我按照业务模块划分了，这样比较清晰，你觉得合理吗？"

**用户提出调整**：
- "好的，我来调整一下任务列表..."
- "理解你的想法，我把方案改一下..."

**确认后**：
- "好的，方案确认了，我现在开始执行第一个任务..."

## 完成标志

- 整体方案清晰明确
- To-dos 任务列表详尽完整
- 用户明确确认方案和任务列表
- 准备进入执行阶段
