# 第三阶段：任务规划

## 触发条件

- 设计文档已完成并获得您的认可
- 或您表示要规划实施任务

## 我的工作

1. 调整到 ultrathink 模式
2. 必须完全了解项目代码，了解项目规范和具体实现，收集足够完善的上下文，再开始工作
3. 仔细研读需求和设计文档
4. 创建 `.claude/specs/{功能名}/tasks.md` 文档
5. 将功能设计转换为一系列代码生成LLM的提示，以测试驱动的方式实现每个步骤
6. 优先考虑最佳实践、渐进式进展和早期测试，确保任何阶段都不会有复杂度的大跳跃
7. 确保每个提示都建立在之前的提示基础上，最后将所有内容连接起来
8. 不应有悬空或孤立的代码未集成到之前的步骤中
9. **只专注于涉及编写、修改或测试代码的任务**

## 任务格式要求

- 使用带编号的复选框列表，最多两级层次结构
- 顶级项目（如史诗）仅在需要时使用
- 子任务使用小数记号编号（如1.1、1.2、2.1）
- 每项必须是复选框
- 优先选择简单结构

## 每个任务项必须包含

- 涉及编写、修改或测试代码的清晰目标作为任务描述
- 任务下的子项目附加信息
- 对需求文档中要求的具体引用（引用细粒度子需求，而非仅用户故事）

## 任务内容约束

- 必须是一系列离散的、可管理的编码步骤
- 每个任务引用需求文档中的特定需求
- 不包含设计文档中已涵盖的过度实现细节
- 假设所有上下文文档（功能需求、设计）在实现期间都可用
- 每个步骤在之前步骤的基础上渐进式构建
- 应优先考虑适当的测试驱动开发
- 覆盖设计中可通过代码实现的所有方面
- 应排序步骤以通过代码早期验证核心功能
- 确保所有需求都被实现任务覆盖
- 默认不包含测试部分的任务，除非用户特别说明

## 任务必须是代码代理可执行的

- 任务应涉及编写、修改或测试特定代码组件
- 任务应指定需要创建或修改的文件或组件
- 任务应具体到代码代理可以执行而无需额外澄清
- 任务应专注于实现细节而非高级概念
- 任务应限定为特定编码活动（如"实现X函数"而非"支持X功能"）

## 明确避免的非编码任务

- 用户验收测试或用户反馈收集
- 部署到生产或预备环境
- 性能指标收集或分析
- 运行应用程序测试端到端流程（但可以编写自动化测试从用户角度测试端到端）
- 用户培训或文档创建
- 业务流程变更或组织变更
- 营销或沟通活动
- 任何无法通过编写、修改或测试代码完成的任务

## 示例格式

```markdown
# 实施计划

- [ ] 1. 设置项目结构和核心接口
  - 为模型、服务、仓库和API组件创建目录结构
  - 定义建立系统边界的接口
  - _需求: 1.1_

- [ ] 2. 实现数据模型和验证
- [ ] 2.1 创建核心数据模型接口和类型
  - 为所有数据模型编写TypeScript接口
  - 实现数据完整性验证函数
  - _需求: 2.1, 3.3, 1.2_

- [ ] 2.2 实现带验证的User模型
  - 编写带验证方法的User类
  - 为User模型验证创建单元测试
  - _需求: 1.2_

[其他编码任务继续...]
```

## 自然地询问

"任务规划看起来合理吗？如果同意的话，我们可以开始逐个实现了"

## 重要约束

- 如果用户表示需要对设计进行任何更改，必须返回设计步骤
- 如果用户表示需要额外需求，必须返回需求步骤
- 必须等待您的明确认可才能完成工作流程
- 如果您要求更改或不明确批准，我必须修改任务文档
- 每次编辑后必须明确请求批准
- 必须继续反馈-修订循环直到获得明确批准
- 如果在实施规划期间发现差距，会提议返回之前步骤（需求或设计）

## 完成标志

您明确同意任务规划
