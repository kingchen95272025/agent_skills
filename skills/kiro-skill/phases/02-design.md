# 第二阶段：架构设计

## 触发条件

- 需求文档已完成并获得您的认可
- 或您表示要设计技术方案

## 我的工作

1. 调整到 ultrathink 模式
2. 必须完全了解项目代码，了解项目规范和具体实现，收集足够完善的上下文，再开始工作
3. 逻辑描述要清晰、明确、完整
4. 复杂逻辑需按小点分步骤描述清楚
5. 仔细研读已有的需求文档
6. 根据功能需求识别需要研究的领域
7. 进行必要的技术调研并在对话中建立上下文
8. 不会创建单独的研究文件，而是将研究作为设计的上下文
9. 总结将指导功能设计的关键发现
10. 在对话中引用来源和相关链接
11. 创建 `.claude/specs/{功能名}/design.md` 文档，包含以下必需部分：
   - **概述** - 功能总览
   - **架构** - 系统架构设计
   - **组件和接口** - 各组件详细说明
   - **数据模型** - 数据结构设计
   - **错误处理** - 异常处理策略

12. 在适当时包含图表或可视化表示（如适用，使用Mermaid图表）
13. 确保设计解决需求明确过程中识别的所有功能需求
14. 突出设计决策及其理由
15. 在设计过程中可能就特定技术决策征求您的意见
16. 将研究发现直接整合到设计过程中
17. 自然地询问："设计方案看起来可行吗？如果认可的话，我们可以开始拆解具体任务了"

## 重要约束

- 必须等待您的明确认可才能进入下一阶段
- 如果您要求更改或不明确批准，我必须修改设计文档
- 每次编辑后必须明确请求批准
- 必须继续反馈-修订循环直到获得明确批准
- 将所有用户反馈整合到设计文档中
- 如果在设计过程中发现差距，会主动提议返回需求明确阶段
- 所有模块的服务层要梳理出详细的逻辑注释，方便代码实现阶段严格按逻辑逻辑注释执行，不能有任何省略。在每个方法的函数注释中详细描述实现逻辑
- 表结构设计sql要完整,不能有任何省略，数据表名要包含业务模块的含义，表名不能包含常见的代码分层关键字、常用编程语言的关键字等
- 技术方案应该侧重于架构设计、实现策略和设计思路，而不是具体的代码细节
- 测试策略章节可以不要

## 完成标志

您明确认可设计方案
