# 第四阶段：预览优化与交付

## 阶段概述

这是Workflow Skill创建的最后一个阶段，目标是对生成的Skill进行质量检查、迭代优化，并最终交付完整的可用Skill。

## 触发条件

- 第三阶段的Skill文件已全部生成
- 或用户明确表示要进行质量检查和优化

## 阶段目标

1. 展示生成Skill的关键部分供用户预览
2. 进行六维度专业质量检查
3. 根据检查结果进行迭代优化
4. 最终交付完整、高质量的Workflow Skill

## 具体工作内容

### 4.1 质量预览

向用户展示生成Skill的关键部分，包括：

#### 预览内容清单

1. **SKILL.md核心部分**
   - YAML前置内容（name和description）
   - 角色定位和价值主张段落
   - 六阶段流程概览
   - 全局约束列表

2. **流程设计概览**
   - 六个阶段的名称和目标
   - 阶段推进逻辑
   - 文件管理结构

3. **评估机制设计**
   - 评估维度列表
   - 评分标准概要
   - 优化策略

4. **交互示例**
   - 1-2个典型对话示例
   - 确认方式示例

### 4.2 专业质量检查

基于六个维度对生成的Skill进行全面评估：

#### 检查维度1：完整性检查 (权重：20%)

**检查内容**：
- 所有必需文件是否齐全（SKILL.md、6个phase文档、README.md）
- 每个文件的结构是否完整
- 是否有遗漏的章节或内容

**检查标准**：
- **9-10分（优秀）**：所有必需文件齐全，结构完整，无遗漏
- **7-8分（良好）**：文件齐全，有1-2处小的遗漏
- **5-6分（及格）**：文件基本齐全，有若干遗漏需补充
- **0-4分（不及格）**：缺少必需文件或重要章节

**检查项目**：
- [ ] SKILL.md包含YAML前置内容
- [ ] SKILL.md包含所有必要章节
- [ ] 6个phase文档都已创建
- [ ] 每个phase文档结构完整
- [ ] README.md已创建
- [ ] reference目录包含必要文档

#### 检查维度2：逻辑性检查 (权重：25%)

**检查内容**：
- 六阶段流程逻辑是否合理
- 阶段之间的输入输出是否匹配
- 流程控制逻辑是否清晰
- 确认机制是否完善

**检查标准**：
- **9-10分（优秀）**：流程逻辑严密，阶段衔接完美，控制清晰
- **7-8分（良好）**：逻辑基本合理，有1-2处小的不顺畅
- **5-6分（及格）**：逻辑可行但有改进空间
- **0-4分（不及格）**：流程逻辑有明显问题

**检查项目**：
- [ ] 阶段推进顺序合理
- [ ] 每个阶段的触发条件明确
- [ ] 输入输出关系清晰
- [ ] 文件状态判断逻辑正确
- [ ] 确认机制设计合理

#### 检查维度3：专业性检查 (权重：25%)

**检查内容**：
- 领域知识是否准确
- 专业术语使用是否恰当
- 评估维度是否符合领域特征
- 工作方式是否符合领域习惯

**检查标准**：
- **9-10分（优秀）**：领域知识精准，术语专业，完全符合行业特点
- **7-8分（良好）**：基本专业，有1-2处可优化
- **5-6分（及格）**：专业性一般，需要加强
- **0-4分（不及格）**：专业性不足，有明显错误

**检查项目**：
- [ ] 领域术语使用准确
- [ ] 评估维度符合领域特征
- [ ] 工作方式描述专业
- [ ] 示例贴近实际场景
- [ ] 参考文档具有专业价值

#### 检查维度4：可用性检查 (权重：15%)

**检查内容**：
- YAML格式是否正确
- 文件路径是否有效
- markdown格式是否规范
- 链接是否正确

**检查标准**：
- **9-10分（优秀）**：格式完全正确，可直接使用
- **7-8分（良好）**：有1-2处格式小问题
- **5-6分（及格）**：有若干格式问题需修正
- **0-4分（不及格）**：格式问题严重影响使用

**检查项目**：
- [ ] YAML前置内容格式正确
- [ ] name符合kebab-case规范
- [ ] description长度符合要求（≤1024字符）
- [ ] 所有文件路径有效
- [ ] markdown语法正确
- [ ] 内部链接正确

#### 检查维度5：创新性检查 (权重：10%)

**检查内容**：
- 是否有独特的设计亮点
- 评估机制是否有创新
- 交互方式是否有特色
- 是否提供独特价值

**检查标准**：
- **9-10分（优秀）**：有明显创新点和独特价值
- **7-8分（良好）**：有一定创新，较为独特
- **5-6分（及格）**：基本遵循标准模式
- **0-4分（不及格）**：完全照搬，无特色

**检查项目**：
- [ ] 工作流设计有特色
- [ ] 评估维度有针对性
- [ ] 交互方式自然友好
- [ ] 提供独特价值主张

#### 检查维度6：规范性检查 (权重：5%)

**检查内容**：
- 是否符合Agent Skill规范
- 文件结构是否标准
- 命名是否规范
- 文档组织是否合理

**检查标准**：
- **9-10分（优秀）**：完全符合Agent Skill规范
- **7-8分（良好）**：基本符合，有小的不规范
- **5-6分（及格）**：部分符合，需要调整
- **0-4分（不及格）**：不符合规范

**检查项目**：
- [ ] 符合Agent Skill目录结构
- [ ] SKILL.md位置正确
- [ ] phases和reference目录规范
- [ ] 文件命名符合规范

### 4.3 评分和报告

#### 评分计算

```
综合得分 = 完整性得分×20% + 逻辑性得分×25% + 专业性得分×25% +
          可用性得分×15% + 创新性得分×10% + 规范性得分×5%
```

#### 质量等级

- **≥9.0分**：卓越 - 可立即交付使用
- **8.0-8.9分**：优秀 - 建议做少量优化
- **7.0-7.9分**：良好 - 建议优化后使用
- **<7.0分**：需改进 - 必须优化

#### 质量检查报告模板

创建 `.claude/skill-creator/{skill-name}/quality_check.md`：

```markdown
# {Skill名称} 质量检查报告

生成时间：{日期}

## 综合评分

**总分**：{X.X}/10.0
**等级**：{质量等级}

## 各维度评分

### 1. 完整性 (权重20%)
- **得分**：{X.X}/10.0
- **评价**：{评价内容}
- **问题**：
  - {问题1（如果有）}
  - {问题2（如果有）}

### 2. 逻辑性 (权重25%)
- **得分**：{X.X}/10.0
- **评价**：{评价内容}
- **问题**：
  - {问题列表}

### 3. 专业性 (权重25%)
- **得分**：{X.X}/10.0
- **评价**：{评价内容}
- **问题**：
  - {问题列表}

### 4. 可用性 (权重15%)
- **得分**：{X.X}/10.0
- **评价**：{评价内容}
- **问题**：
  - {问题列表}

### 5. 创新性 (权重10%)
- **得分**：{X.X}/10.0
- **评价**：{评价内容}
- **亮点**：
  - {亮点列表}

### 6. 规范性 (权重5%)
- **得分**：{X.X}/10.0
- **评价**：{评价内容}
- **问题**：
  - {问题列表}

## 优化建议

### 高优先级（必须修复）
1. {建议1}
2. {建议2}

### 中优先级（建议修复）
1. {建议1}
2. {建议2}

### 低优先级（可选优化）
1. {建议1}
2. {建议2}

## 总结

{整体评价和建议}

## 后续行动

- [ ] {建议的下一步行动}
```

### 4.4 迭代优化

#### 优化策略

根据综合得分决定优化策略：

**得分≥9.0**：
- 无需优化，直接进入交付
- 询问用户是否满意

**得分8.0-8.9**：
- 建议进行一轮小幅优化
- 主要针对高优先级问题
- 优化后可直接交付

**得分7.0-7.9**：
- 建议进行1-2轮优化
- 解决高优先级和中优先级问题
- 目标：提升到8.5分以上

**得分<7.0**：
- 必须进行2-3轮优化
- 全面解决所有识别的问题
- 目标：至少达到8.0分

#### 优化流程

**第一轮优化**（如果综合得分 < 9.0）：
1. 修复所有高优先级问题
2. 修复部分中优先级问题
3. 重新进行质量检查
4. 更新quality_check.md

**第二轮优化**（如果第一轮后仍 < 8.5）：
1. 修复剩余中优先级问题
2. 优化部分低优先级问题
3. 再次质量检查
4. 更新报告

**第三轮优化**（如果仍需要）：
1. 精细打磨细节
2. 追求完美
3. 最终质量检查
4. 这是最后一轮

#### 优化循环控制

- **最多3轮优化**
- 每轮优化后重新评分
- 达到8.5分以上即可停止
- 第3轮后无论得分如何都进入交付

### 4.5 最终交付

#### 交付清单检查

在最终交付前，确认以下清单：

- [ ] 所有必需文件已创建
- [ ] YAML格式正确
- [ ] 所有变量已替换
- [ ] 文件间内容一致
- [ ] markdown格式规范
- [ ] 链接全部有效
- [ ] 质量检查得分≥8.0
- [ ] 用户明确满意

#### 交付包内容

最终交付的Skill包含：

```
.claude/skills/{skill-name}/
├── SKILL.md                    # Skill主文件
├── README.md                   # 使用说明
├── quality_check.md            # 质量检查报告
├── phases/                     # 阶段详细指南
│   ├── 01-{阶段1}.md
│   ├── 02-{阶段2}.md
│   ├── 03-{阶段3}.md
│   ├── 04-{阶段4}.md
│   ├── 05-{阶段5}.md
│   └── 06-{阶段6}.md
└── reference/                  # 参考文档
    ├── PROMPT_TEMPLATE.md
    ├── VARIABLE_MAPPING.md
    └── {其他参考文档}.md
```

#### 使用建议

向用户提供使用建议：

```markdown
# 使用建议

## 1. 测试Skill

创建完成后，建议测试一下：

\`\`\`
# 询问Claude可用的skills
"What skills are available?"

# 提出匹配的请求触发skill
"{触发示例请求}"
\`\`\`

## 2. 调整description

如果Claude没有自动使用这个skill，可以：
- 在description中添加更多触发关键词
- 使描述更具体、更明确

## 3. 分享给团队

如果要与团队分享：
- 项目skill：提交到`.claude/skills/`
- 插件分发：考虑创建Claude Code插件

## 4. 持续改进

根据使用反馈：
- 优化阶段设计
- 调整评估维度
- 完善交互示例
```

## 重要约束

1. **质量标准严格**
   - 必须进行完整的六维度检查
   - 不能跳过任何检查项
   - 评分必须客观、有依据

2. **优化必要性判断**
   - 得分<9.0都应建议优化
   - 必须向用户说明优化的价值
   - 尊重用户选择（是否优化）

3. **用户确认机制**
   - 质量检查报告必须给用户查看
   - 优化方案必须获得用户同意
   - 最终交付必须获得用户确认

4. **文档完整性**
   - 必须生成quality_check.md
   - 如果进行了优化，必须更新报告
   - 保留优化历史记录

## 交互示例

### 示例1：高分直接交付

**AI**: "质量检查完成！让我展示评分结果：

**综合得分：9.2/10.0**（卓越）

各维度评分：
- 完整性：9.5/10（所有文件齐全，结构完整）
- 逻辑性：9.0/10（流程严密，衔接完美）
- 专业性：9.3/10（领域知识精准，术语专业）
- 可用性：9.0/10（格式正确，可直接使用）
- 创新性：8.5/10（评估机制有特色）
- 规范性：10.0/10（完全符合Agent Skill规范）

**结论**：质量卓越，可立即交付使用！

Skill已准备就绪，您可以开始使用了。需要我提供使用建议吗？"

### 示例2：需要优化

**AI**: "质量检查完成。评分结果：

**综合得分：7.6/10.0**（良好）

主要发现：
- ✅ 完整性和逻辑性都很好
- ⚠️  专业性有提升空间（第2、3阶段的示例不够具体）
- ⚠️  可用性有小问题（YAML description超过1024字符）

**建议进行一轮优化**，主要解决：
1. 精简description到1024字符以内
2. 为第2、3阶段补充更具体的示例
3. 优化几处专业术语的使用

预计优化后可达到8.5分以上。要进行优化吗？"

**用户**: "好的，进行优化。"

**AI**: "开始第一轮优化..."

[执行优化]

**AI**: "优化完成！重新评分：

**综合得分：8.7/10.0**（优秀）

改进情况：
- ✅ description精简到980字符
- ✅ 补充了详细的实际使用示例
- ✅ 优化了专业术语表达

现在质量已达到优秀水平，可以交付了。您满意吗？"

### 示例3：多轮优化

**AI**: "第一轮优化完成，重新评分：**7.9/10.0**

虽然有改进，但还有提升空间。建议第二轮优化：
- 进一步优化评估维度的评分标准
- 增强第4阶段的示例完整性

继续优化吗？"

**用户**: "继续。"

**AI**: "第二轮优化完成，最终得分：**8.6/10.0**（优秀）

经过两轮优化，Skill质量已经很好了。可以交付使用。"

## 完成标志

当满足以下条件时，第四阶段完成：

1. ✅ 已完成六维度质量检查
2. ✅ 已生成quality_check.md报告
3. ✅ 综合得分≥8.0（或已完成3轮优化）
4. ✅ 所有高优先级问题已解决
5. ✅ 用户明确满意并确认交付

## 自然确认询问

阶段完成时，使用以下方式之一确认：

- "质量检查得分{X.X}分，Skill已经准备就绪！现在可以开始使用了。需要我提供使用建议吗？"
- "{Skill名称}已完成，所有文件都已优化到最佳状态。您满意这个成果吗？"
- "经过{N}轮优化，Skill质量达到{等级}水平。准备好交付了吗？"

## 工作流程完成

用户确认满意后，整个Workflow Skill创建流程圆满完成！生成的Skill可以立即投入使用。
