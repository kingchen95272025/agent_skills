# 第三阶段：Skill完整生成

## 阶段概述

基于前两阶段的需求分析和流程设计，生成完整的Workflow Skill，包括SKILL.md主文件、phases阶段指南、reference参考文档等所有必要文件。

## 触发条件

- 第二阶段的 `workflow_design.md` 已完成并获得用户认可
- 或用户明确表示要生成Skill

## 阶段目标

1. 基于通用模板进行系统化的变量替换
2. 生成符合Agent Skill规范的SKILL.md主文件
3. 生成六个阶段的详细实施指南文档（phases目录）
4. 生成必要的参考文档（reference目录）
5. 确保所有文件符合Agent Skill标准

## 具体工作内容

### 3.1 模板变量映射

基于 `requirements.md` 和 `workflow_design.md`，建立完整的变量映射表：

#### 变量映射表模板

```markdown
## 模板变量映射

### 基础变量
- {领域名} → {从requirements提取的领域}
- {角色名} → {从requirements提取的角色名，kebab-case}
- {专业领域} → {具体专业领域}
- {输入类型} → {用户输入的原始材料类型}
- {输出类型} → {最终交付的成果类型}

### 用户相关变量
- {目标用户} → {主要服务对象}
- {背景特征} → {用户的专业背景}
- {类比对象} → {用于类比的专业角色}
- {交互特色} → {沟通风格描述}
- {价值主张描述} → {核心价值主张}

### 工作流变量
- {目录名} → {技能文件存储目录名}
- {流程名称} → {工作流程的总称}
- {需求类型} → {用户通常提出的需求类型}
- {核心动作} → {工作流的核心动作}
- {主题名} → {具体任务的主题名称}

### 六阶段变量
- {阶段1名称} → {从workflow_design提取}
- {阶段1描述} → {阶段1的简短描述}
- {阶段1动作} → {进入阶段1的动作描述}
- {阶段1成果} → {阶段1的输出成果}
- {阶段1文件} → {从workflow_design提取的file1}
- {阶段1确认问句} → {阶段1完成的自然确认方式}
... (对阶段2-6重复同样的变量)

### 文件变量
- {文件1} → {阶段1对应的文件名，不含.md}
- {文件2} → {阶段2对应的文件名}
- {文件3} → {阶段3对应的文件名}
- {文件5} → {阶段5对应的文件名}
(review.md和final.md是固定的)

### 评估变量
- {评估类型} → {评估的类型名称，如"质量复核"}
- {维度1} → {第1个评估维度名称}
- {权重1} → {第1个维度的权重百分比}
- {评估内容1} → {第1个维度的评估要点}
... (对维度2-N重复)

### 工作方式变量
- {工作风格描述} → {协作方式和风格}
- {领域特点描述} → {领域的特殊性描述}
- {积极态度表达} → {正面态度的表达}
- {服务特色} → {提供的独特服务}
- {态度特征} → {工作态度描述}
- {工作状态} → {期望的工作状态}
- {流程类型} → {流程的性质描述}
- {体验描述} → {用户体验的描述}

### 其他变量
- {核心概念名称} → {工作流的核心概念}
- {示例名称} → {kebab-case格式的示例}
- {动作类型} → {用户常见的动作类型}
- {成果类型} → {最终成果的类型}
```

### 3.2 生成SKILL.md主文件

创建 `.claude/skills/{skill-name}/SKILL.md`，包含：

#### SKILL.md结构

```markdown
---
name: {kebab-case格式的skill名称}
description: {领域}{工作流类型}。当用户需要{使用场景列表}时使用。适用于需要{特征列表}的{领域}{应用场景}。
---

# {Skill标题}

{开场白，介绍角色和核心价值}

{工作方式描述}

## 全局约束

**重要：以下约束在整个工作流程中必须严格遵守**

- {约束1}
- {约束2}
- ...

## {流程名称}

{六个阶段的简要列表}

## 流程控制逻辑

### 阶段识别和导航
{说明如何识别当前阶段}

### 自动阶段推进
{基于文件状态的阶段推进逻辑}

### 自然语言交互原则
{无需记忆命令、智能理解意图等原则}

## 六个阶段详细指南

{列出六个phases文档的链接}

## 参考文档

{列出reference目录中的参考文档}

## 错误处理和特殊情况

{缺少前置条件、工作流中断、用户反馈集成}

## 交互示例

{自然对话示例}

## 文件管理

{目录结构和进度跟踪}

## 协作原则

{10条核心协作原则}

## 使用指南

{快速开始、高级定制等}

## 开始创建

{引导用户开始使用}
```

#### YAML前置内容要求

- **name**: 必须是kebab-case格式，只包含小写字母、数字和连字符，最多64字符
- **description**: 清晰描述功能和使用时机，最多1024字符，应包含：
  - 领域描述
  - 主要功能
  - 使用场景（"当用户需要...时使用"）
  - 适用场景（"适用于..."）

### 3.3 生成Phases阶段指南

创建六个详细的阶段实施指南文档：

#### Phases目录结构

```
phases/
├── 01-{阶段1-kebab-case}.md
├── 02-{阶段2-kebab-case}.md
├── 03-{阶段3-kebab-case}.md
├── 04-{阶段4-kebab-case}.md
├── 05-{阶段5-kebab-case}.md
└── 06-{阶段6-kebab-case}.md
```

#### 每个Phase文档的标准结构

```markdown
# 第X阶段：{阶段名称}

## 阶段概述
{阶段的简要说明}

## 触发条件
- {触发条件1}
- {触发条件2}

## 阶段目标
1. {目标1}
2. {目标2}
3. {目标3}

## 具体工作内容

### X.1 {工作内容1}
{详细说明}

### X.2 {工作内容2}
{详细说明}

### X.3 {工作内容3}
{详细说明}

## 重要约束
1. **{约束类型1}**
   - {约束细节}

2. **{约束类型2}**
   - {约束细节}

## 交互示例

### 示例1：{场景1}
{完整的对话示例}

### 示例2：{场景2}
{完整的对话示例}

## 文档模板

{如果此阶段需要生成文档，提供详细的文档模板}

## 完成标志
当满足以下条件时，第X阶段完成：
1. ✅ {完成条件1}
2. ✅ {完成条件2}

## 自然确认询问
{列出3-4种自然的确认方式}

## 进入下一阶段
用户明确同意后，进入第{X+1}阶段：**{下一阶段名称}**
```

#### 特别注意：第4阶段（评估）

第4阶段的文档必须包含完整的评估维度设计：

```markdown
# 第四阶段：{评估阶段名称}

## 阶段概述
{评估阶段说明}

## 评估维度设计

### 维度1：{维度名称} (权重：{百分比}%)

**评估内容**：
- {评估要点1}
- {评估要点2}

**评分标准（0-10分）**：
- **9-10分（优秀）**：{标准}
- **7-8分（良好）**：{标准}
- **5-6分（及格）**：{标准}
- **0-4分（不及格）**：{标准}

{对其他维度重复}

## 评分机制

**综合得分计算**：
```
综合得分 = Σ(维度得分 × 权重)
```

**质量标准**：
- ≥8.5分：优秀，直接交付
- 6.0-8.4分：良好，建议优化
- <6.0分：需改进，必须优化

## 评估报告模板

{提供review.md的详细模板}
```

### 3.4 生成Reference参考文档

创建必要的参考文档，至少包括：

#### 1. PROMPT_TEMPLATE.md

将通用的六阶段工作流模板复制到reference目录，作为参考。

#### 2. VARIABLE_MAPPING.md

```markdown
# 模板变量映射表

## 说明
本文档列出了从通用模板生成{Skill名称}时的所有变量替换规则。

## 实际映射

{列出所有变量的实际映射值}

## 使用示例

**模板原文**：
```
我是{角色名}，您的AI{专业领域}助手。
```

**替换后**：
```
我是{实际角色名}，您的AI{实际专业领域}助手。
```
```

#### 3. 领域相关的参考文档

根据具体领域，可能需要添加：
- 编码规范（技术类）
- 写作风格指南（内容类）
- 设计标准（设计类）
- 行业最佳实践（专业类）

### 3.5 生成README.md

创建 `.claude/skills/{skill-name}/README.md`，包含：

```markdown
# {Skill名称}

{一句话描述}

## 简介

{详细介绍这个Skill的功能和价值}

## 使用方式

这个Skill会被Claude自动调用，当您的请求匹配以下场景时：
- {场景1}
- {场景2}
- {场景3}

## 工作流程

{简要说明六个阶段}

## 文件结构

```
{skill-name}/
├── SKILL.md              # Skill主文件
├── README.md             # 本文件
├── phases/               # 六个阶段的详细指南
│   ├── 01-{阶段1}.md
│   ├── 02-{阶段2}.md
│   ├── 03-{阶段3}.md
│   ├── 04-{阶段4}.md
│   ├── 05-{阶段5}.md
│   └── 06-{阶段6}.md
└── reference/            # 参考文档
    ├── PROMPT_TEMPLATE.md
    ├── VARIABLE_MAPPING.md
    └── {其他参考文档}.md
```

## 特色功能

- {特色1}
- {特色2}
- {特色3}

## 示例

{简单的使用示例}

## 注意事项

{重要的使用注意事项}
```

## 重要约束

1. **Agent Skill规范遵循**
   - SKILL.md必须包含正确的YAML前置内容
   - name必须是kebab-case格式
   - description必须清晰描述功能和使用时机
   - 文件结构必须符合标准

2. **模板变量完全替换**
   - 所有{变量}必须被替换为实际值
   - 不能遗留任何未替换的变量
   - 替换后的内容必须语义通顺

3. **内容一致性**
   - SKILL.md、phases文档、reference文档之间必须一致
   - 阶段名称、文件名、描述必须统一
   - 评估维度在所有相关文档中必须一致

4. **专业化定制**
   - 必须针对具体领域进行专业化表达
   - 使用该领域的专业术语和行业规范
   - 示例必须贴近实际使用场景

5. **用户确认机制**
   - 生成完成后必须请用户预览
   - 如果用户要求修改，必须调整后再次确认
   - 必须继续反馈-修订循环直到获得明确批准

## 生成流程

### 步骤1：创建目录结构

```bash
mkdir -p .claude/skills/{skill-name}/{phases,reference}
```

### 步骤2：生成SKILL.md

1. 基于通用模板
2. 替换所有变量
3. 专业化定制内容
4. 添加正确的YAML前置内容

### 步骤3：生成六个Phase文档

1. 基于workflow_design.md中的阶段设计
2. 为每个阶段创建详细指南
3. 包含完整的示例和模板
4. 第4阶段必须包含完整评估体系

### 步骤4：生成Reference文档

1. 复制PROMPT_TEMPLATE.md
2. 创建VARIABLE_MAPPING.md
3. 根据需要添加领域参考文档

### 步骤5：生成README.md

1. 编写清晰的使用说明
2. 列出文件结构
3. 提供示例

### 步骤6：质量检查

1. 检查YAML格式正确性
2. 检查所有变量已替换
3. 检查文件间一致性
4. 检查markdown格式

## 交互示例

### 示例：Skill生成过程

**AI**: "好的，基于您的需求分析和流程设计，现在开始生成完整的{Skill名称}。

我将创建：
1. SKILL.md主文件
2. 六个阶段的详细指南（phases目录）
3. 参考文档（reference目录）
4. README使用说明

开始生成..."

[执行生成过程]

**AI**: "Skill生成完成！已创建以下文件：

```
.claude/skills/{skill-name}/
├── SKILL.md
├── README.md
├── phases/
│   ├── 01-{阶段1}.md
│   ├── 02-{阶段2}.md
│   ├── 03-{阶段3}.md
│   ├── 04-{阶段4}.md
│   ├── 05-{阶段5}.md
│   └── 06-{阶段6}.md
└── reference/
    ├── PROMPT_TEMPLATE.md
    ├── VARIABLE_MAPPING.md
    └── {其他文档}.md
```

请查看SKILL.md的内容，看看是否符合您的期望？"

**用户**: "看起来不错，但是第3阶段的描述可以更详细一点。"

**AI**: "好的，让我更新第3阶段的phases文档，增加更详细的工作内容描述和示例..."

[更新文件]

**AI**: "已更新phases/03-{阶段3}.md，增加了更详细的说明和实际示例。请再看看？"

**用户**: "现在好了！"

**AI**: "太好了！完整的Workflow Skill已生成完毕。准备好进入预览优化阶段，做最后的质量检查了吗？"

## 完成标志

当满足以下条件时，第三阶段完成：

1. ✅ 已创建所有必需文件（SKILL.md、README.md、6个phase文档）
2. ✅ YAML前置内容格式正确
3. ✅ 所有模板变量已替换
4. ✅ 文件间内容一致
5. ✅ 用户明确认可生成的Skill

## 自然确认询问

阶段完成时，使用以下方式之一确认：

- "完整的Workflow Skill已生成！请预览内容，是否满足您的期望？需要调整吗？"
- "{Skill名称}的所有文件都已创建完成。请查看SKILL.md和phases文档，符合要求吗？"
- "Skill生成完毕！包括主文件、6个阶段指南和参考文档。要不要进入质量检查阶段？"

## 进入下一阶段

用户明确同意后，进入第四阶段：**预览优化与交付**
