# 技术设计文档标准格式

本文档定义了 Kiro 工作流第二阶段（架构设计）中技术设计文档的标准格式和质量要求。

## 标准文档结构

技术设计文档必须包含以下9个部分，不能省略任何部分：

### 第一部分：概述 (必需)

```markdown
# [功能名称]技术设计方案

## 1. 概述

### 1.1 项目背景
[功能的业务背景和解决的问题]

### 1.2 技术目标
[技术实现的目标和预期效果，用列表形式]
- **目标1**：具体描述
- **目标2**：具体描述

### 1.3 核心特性
[核心功能特性列表]
- **特性1**：详细描述
- **特性2**：详细描述
```

### 第二部分：系统架构 (必需)

```markdown
## 2. 系统架构

### 2.1 总体架构
[必须包含Mermaid架构图，展示各层次关系]

### 2.2 分层架构

#### 2.2.1 控制器层(Controller)
- 处理HTTP请求和响应
- 参数验证和数据转换
- 调用业务服务层
- 统一JSON响应格式

#### 2.2.2 服务层(Service)
- 封装业务逻辑和流程
- 处理复杂的业务规则
- 管理数据库事务
- 协调多个Repository操作

#### 2.2.3 仓储层(Repository)
- 数据访问抽象
- 复杂查询构建
- 数据持久化操作
- 数据权限控制

#### 2.2.4 模型层(Model)
- 数据模型定义
- 数据关系映射
- 数据验证和转换
- 业务逻辑封装

### 2.3 核心组件
[各核心组件的职责描述]

### 2.4 数据流设计
[必须包含Mermaid序列图，展示关键业务流程]
```

### 第三部分：核心模块设计 (必需)

```markdown
## 3. 核心模块设计

### 3.1 [模块1]模块

#### 3.1.1 功能职责
- **职责1**：详细描述
- **职责2**：详细描述

#### 3.1.2 核心业务规则
- 规则1：具体说明
- 规则2：具体说明

### 3.2 [模块2]模块
[同上格式]
```

### 第四部分：数据库设计 (必需)

**数据库设计要求：**

- **必须提供完整的CREATE TABLE语句**
- **表命名规范**：使用spo_前缀，表名必须体现业务含义，避免使用技术词汇
- **字段规范**：必须包含标准的created_at、created_by、updated_at、updated_by、deleted_at、deleted_by、last_updated_at字段
- **索引策略**：必须明确主键索引、唯一索引、普通索引、复合索引的完整设计

```markdown
## 4. 数据库设计

### 4.1 数据库概览
[数据表概述和关系说明]

### 4.2 表关系设计
[必须包含Mermaid ER图]

### 4.3 数据库表结构SQL设计
[必须包含完整的建表SQL语句，不能有任何省略]
```

### 第五部分：组件和接口设计 (必需)

**组件设计要求：**

- 所有分层的文件都要罗列出来，设计好具体函数方法名，但不要写具体的代码实现
- Model层、仓储层、服务层、控制器层、资源转换层 (Resource) 这几个分层是重点，不可欠缺遗漏
- 所有模块的服务层要梳理出详细的逻辑注释，方便代码实现阶段严格按逻辑注释执行，不能有任何省略
- 在每个方法的函数注释中详细描述实现逻辑
- 模型层要设计好完整的PHP类结构和PHPDoc注释，参考`CODE_EXAMPLES.md`中的模型层设计示例
- 仓储层要设计好具体的方法签名和说明，参考`CODE_EXAMPLES.md`中的仓储层设计示例
- 服务层要设计好详细的逻辑步骤注释，每个方法都要有完整的实现逻辑描述，参考`CODE_EXAMPLES.md`中的服务层设计示例
- 控制器层要设计好完整的方法签名和参数说明，参考`CODE_EXAMPLES.md`中的控制器层设计示例
- 资源转换层要设计好完整的数据转换格式，参考`CODE_EXAMPLES.md`中的资源转换层设计示例
- 验证层要设计好所有请求验证类的完整定义，参考`CODE_EXAMPLES.md`中的验证层设计示例
- 枚举类要设计好所有相关枚举类的完整定义，参考`CODE_EXAMPLES.md`中的枚举类设计示例
- 路由层要设计好完整的路由定义，参考`CODE_EXAMPLES.md`中的路由设计示例

**组件设计示例：**
```markdown
## 5. 组件和接口设计

### 5.1 模型层(Model)设计
[必须包含完整的PHP类结构和PHPDoc注释]

### 5.2 仓储层(Repository)设计
[必须包含完整的方法签名和说明，不要写具体的代码实现]

### 5.3 服务层(Service)设计
[必须包含详细的逻辑步骤注释，每个方法都要有完整的实现逻辑描述，不要写具体的代码实现]

### 5.4 控制器层(Controller)设计
[必须包含完整的方法签名和参数说明，不要写具体的代码实现]

### 5.5 资源转换层(Resource)设计
[必须包含完整的数据转换格式]

### 5.6 验证层(Request)设计
[必须包含所有请求验证类的完整定义]

### 5.7 枚举类设计(Enum)
[必须包含所有相关枚举类的完整定义]

### 5.8 路由层(Route)设计
[完整的路由定义]

```

### 第六部分：总结 (必需)

```markdown
## 6. 总结

### 6.1 技术设计完整性
### 6.2 技术特色
### 6.3 实施准备
```

## 架构图表要求

### 总体架构图

- **必须使用Mermaid图表**
- 清晰展示前端展示层→API接口层→业务服务层→数据访问层→数据存储层的完整分层

### 数据流程图

- **必须使用Mermaid序列图**
- 展示用户→控制器→服务→仓储→数据库的完整交互流程

### 数据表关系图

- **必须使用Mermaid ER图**
- 展示所有数据表的关系和字段结构

## 业务规则要求

- **核心业务规则**：每个模块必须明确列出核心业务规则，包含状态流转、数据验证、权限控制等
- **异常处理**：必须说明业务异常的处理策略和错误码设计
- **多语言支持**：必须说明翻译系统的集成方案

## 文档完整性要求

- **逻辑追溯性**：设计文档中的每个组件都必须能追溯到需求文档中的具体需求
- **实施可行性**：所有设计都必须基于现有技术栈，符合项目规范和最佳实践
- **代码可生成性**：设计细节必须详细到足以直接生成可运行的代码，不能有模糊或抽象的描述

## 技术设计质量标准

1. **完整性**：所有9个部分必须完整，不能省略
2. **具体性**：每个设计都要具体到可以直接转化为代码
3. **可追溯性**：每个设计元素都能追溯到具体的需求
4. **规范性**：严格遵循项目的代码规范和最佳实践
5. **可视化**：必须包含Mermaid图表来辅助理解架构和流程
6. **多语言**：所有代码分层都要适配多语言
7. **无硬编码**：使用枚举Enum来替代所有硬编码

详细的代码设计示例请严格参考 [CODE_EXAMPLES.md](CODE_EXAMPLES.md)，保证代码设计示例的格式和要求与标准格式一致。
