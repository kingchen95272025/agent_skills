# 第二阶段：架构设计

## 触发条件

- 需求文档已完成并获得您的认可
- 或您表示要设计技术方案

## 技术设计方案要求

- prd中所有的需求点都要完整的包含在技术设计方案中
- 技术方案应该侧重于架构设计、实现策略和设计思路，而不是具体的代码细节
- 严格参考文档中设计示例的格式和要求，保持一致，保持简洁的方案格式
- 所有分层的文件都要罗列出来，设计好具体函数方法名，但不要写具体的代码实现。Model层、仓储层、服务层、控制器层、资源转换层 (Resource) 这几个分层是重点，不可欠缺遗漏
- 所有模块的服务层要梳理出详细的逻辑注释，方便代码实现阶段严格按逻辑逻辑注释执行，但不要写具体的代码实现
- 表结构设计sql要完整,不能有任何省略，数据表名要包含业务模块的含义
- 必须严格遵守代码规范
- 所有代码分层都要适配多语言，多语言的key直接参考现在用中文为key，枚举层Enum必须维护多语言翻译
- 业务异常码要是数字
- 严禁出现硬编码，使用枚举Enum来替代硬编码

## 我的工作

1.【必须第一步】必须先通读并严格遵守 `.cursor/rules` 目录指定的所有规则。这个目录下的mdc规则文件里指定了参考文件，优先参照指定的参考文件。
   必须完全了解项目代码，了解项目规范和具体实现，收集足够完善的上下文，再开始工作。

2.【必须第二步】必须严格遵守设计文档标准格式，并完全理解其中的格式要求和示例：
   - 读取 [技术设计文档标准](../reference/DESIGN_STANDARDS.md) - 了解技术设计文档的9个标准部分结构
   - 读取 [代码设计示例](../reference/CODE_EXAMPLES.md) - 了解各层次代码的详细设计示例格式

3. 逻辑描述要清晰、明确、完整
4. 复杂逻辑需按小点分步骤描述清楚
5. 仔细研读已有的需求文档
6. 根据功能需求识别需要研究的领域
7. 进行必要的技术调研并在对话中建立上下文
8. 不会创建单独的研究文件，而是将研究作为设计的上下文
9. 总结将指导功能设计的关键发现
10. 在对话中引用来源和相关链接
11. 创建 `.claude/specs/{功能名}/design.md` 文档
13. 在适当时包含图表或可视化表示（如适用，使用Mermaid图表）
14. 确保设计解决需求明确过程中识别的所有功能需求
15. 突出设计决策及其理由
16. 在设计过程中可能就特定技术决策征求您的意见
17. 将研究发现直接整合到设计过程中
18. 自然地询问："设计方案看起来可行吗？如果认可的话，我们可以开始拆解具体任务了"
19. 每个代码分层的文档书写之前，都要先参考代码设计示例，保证代码设计示例的格式和要求与标准格式一致。确定并输出每个代码分层书写的规范等用户认可后，再开始书写。


## 设计文档标准格式

请严格参考 [../reference/DESIGN_STANDARDS.md](../reference/DESIGN_STANDARDS.md) 获取完整的技术设计文档标准格式（9个部分），保证技术设计文档的格式和要求与标准格式一致。

## 代码设计示例

请严格参考 [../reference/CODE_EXAMPLES.md](../reference/CODE_EXAMPLES.md) 获取各层次代码的详细设计示例，保证代码设计示例的格式和要求与标准格式一致。

## 重要约束

- 必须等待您的明确认可才能进入下一阶段
- 如果您要求更改或不明确批准，我必须修改设计文档
- 每次编辑后必须明确请求批准
- 必须继续反馈-修订循环直到获得明确批准
- 将所有用户反馈整合到设计文档中
- 如果在设计过程中发现差距，会主动提议返回需求明确阶段
- 测试策略章节可以不要
- 架构设计文档一般都比较长，可以分多个章节来写，每个章节都要有清晰的标题和内容，章节之间要有清晰的逻辑关系，不要出现重复的内容
- 每个代码分层写之前，都要先参考代码设计示例，保证代码设计示例的格式和要求与标准格式一致。确定并输出每个代码分层书写的规范等用户认可后，再开始书写。

## 完成标志

您明确认可设计方案
