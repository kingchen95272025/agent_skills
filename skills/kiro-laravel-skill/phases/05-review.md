# 第五阶段：代码复核

## 触发条件

- 所有代码实现任务已完成并创建completed_tasks.md文件
- 或您明确要求进行代码复核

## 我的工作

### 1. 全面代码分析

- 必须完全了解项目代码，了解项目规范和具体实现，收集足够完善的上下文，再开始复核工作
- 仔细阅读requirements.md、design.md、tasks.md和所有已实现的代码
- 检查代码实现与需求文档的一致性
- 验证代码是否符合设计文档中的架构决策

### 2. 多维度评估

- **需求符合度评估**：检查每个需求是否完全实现，是否存在遗漏或偏差
- **设计一致性评估**：验证实现是否遵循设计文档中的架构、接口、数据模型等规范
- **代码规范评估**：检查代码是否符合项目的编码规范、最佳实践
- **代码质量评估**：评估代码的可读性、可维护性、性能、安全性等

### 3. 评分机制

详见 [../reference/REVIEW_CRITERIA.md](../reference/REVIEW_CRITERIA.md)

每个维度使用0-10分评分，最终计算综合得分：

- **需求符合度** (25%权重)
- **设计一致性** (25%权重)
- **代码规范性** (25%权重)
- **代码质量** (25%权重)
- **综合得分** = 各维度得分 × 权重之和

### 4. 复核报告生成

创建 `.claude/specs/{功能名}/review.md` 文档，包含：

- **评分总览**：各维度得分和综合得分
- **符合度分析**：详细对比需求、设计与实现的一致性
- **问题清单**：发现的所有问题，按严重程度分类
- **改进建议**：具体的优化建议和修改方案
- **优化优先级**：建议的修复顺序

### 5. 完成标准判断

- 综合得分 >= 8.5分：代码质量优秀，可直接完成
- 综合得分 6.0-8.4分：存在改进空间，建议优化
- 综合得分 < 6.0分：必须进行优化

### 6. 交互确认

- 如果综合得分 >= 8.5分，询问："代码复核完成，质量评估为优秀。是否直接完成项目？"
- 如果需要优化，询问："发现了一些需要改进的地方，是否开始代码优化？"

## 重要约束

- 必须基于完整的需求、设计、任务文档进行复核
- 评分必须客观、详细，有具体的问题和建议支撑
- 复核报告必须清晰、可操作，便于后续优化
- 必须等待用户明确决定是否进入优化阶段

## 完成标志

创建review.md文件并获得用户对后续行动的明确指示
