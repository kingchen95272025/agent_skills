# 第三阶段：文档 (Document)

## 触发条件

- 分析阶段完成
- 已完成数据维度和关系分析
- 准备输出产品经理可用的文档

## 阶段目标

将分析结果转化为产品经理可直接使用的业务文档，**所有内容统一输出到一个文件**。

## 工作模式

### 标准模式（默认）

完整输出，包含所有章节，详细说明。

### 快速模式

当用户说"快速梳理"、"快速分析"时启用，精简输出核心内容。

## 文档写作原则

### 核心原则：先结论后详细

**文档必须遵循"结论前置"原则**：

1. **开篇一页纸结论** - 文档开头用简洁的摘要给出核心结论
2. **分层展开** - 结论之后再展开详细说明
3. **按需阅读** - 产品经理可以只看结论，也可以深入阅读细节
4. **每章节也先结论** - 每个章节开头也先给该章节的核心要点

### 业务逻辑闭环原则

**梳理业务逻辑必须闭环全面**：

1. **上游追溯** - 数据从哪来？什么操作产生？
2. **下游梳理** - 数据被谁用？影响哪些后续流程？
3. **横向关联** - 与哪些其他模块有交互？
4. **异常覆盖** - 异常情况如何处理？逆向流程是什么？

### 产品经理友好

1. **自然语言为主** - 用日常业务语言描述，像在向同事解释业务
2. **避免技术术语** - 不使用"表"、"字段"、"外键"等技术词汇
3. **场景化描述** - 结合具体业务场景说明
4. **图表辅助** - 用图表直观展示关系和流程
5. **代码仅作参考** - 代码信息放在附录，供技术人员参考

### 术语转换对照

| 技术术语 | 产品语言 |
|----------|----------|
| 表/Table | 业务数据 |
| 字段/Column | 信息项 |
| 外键关系 | 关联关系 |
| 一对多关系 | 一个...包含多个... |
| Model/模型 | 业务对象 |
| 主键ID | 唯一标识 |
| 枚举/Enum | 状态/类型选项 |

## 统一文档结构

**文件名**：`{module}_业务梳理.md`

**输出位置**：`docs/业务文档/` 目录

### 标准模式文档结构

```markdown
# {模块名称} 业务梳理

## 文档信息

- **整理时间**：{时间}
- **整理范围**：{模块范围}

---

## 核心结论（一页纸摘要）

> 本章节提供核心结论，产品经理可以只看这部分快速获取答案

### 这个模块是做什么的？

{用1-2句话说明模块的核心功能}

### 涉及哪些业务对象？

| 业务对象 | 一句话说明 | 数据粒度 |
|----------|------------|----------|
| {对象1} | {说明} | {粒度} |
| {对象2} | {说明} | {粒度} |

### 核心业务流程

{用一句话描述主流程}：{步骤1} → {步骤2} → {步骤3} → ...

### 关键业务规则（Top 5）

1. {最重要的规则1}
2. {最重要的规则2}
3. {最重要的规则3}
4. {最重要的规则4}
5. {最重要的规则5}

### 关联模块

本模块与以下模块有交互：
- **{模块A}**：{交互说明}
- **{模块B}**：{交互说明}

---

> 以下是详细说明，按需阅读

---

## 一、业务概述

{用2-3段话描述这个业务模块是做什么的，解决什么问题}

---

## 二、核心业务对象

### 2.1 {业务对象1}（主要业务数据）

**是什么**：{一句话描述}

**数据粒度**：{以什么为单位}

**关键信息**：

| 信息项 | 说明 | 示例 |
|--------|------|------|
| xxx | xxx | xxx |

**业务规则**：
- {规则1}
- {规则2}

### 2.2 {业务对象2}

...

---

## 三、业务对象关系

### 关系一览图

​```mermaid
erDiagram
    用户 ||--o{ 订单 : "下单"
    订单 ||--|{ 商品明细 : "包含"
​```

### 关系详细说明

**{对象A} 与 {对象B}**：
- {关系描述}
- 举例：{具体例子}

---

## 四、业务流程

### 4.1 {流程名称}

​```mermaid
flowchart TD
    A[步骤1] --> B[步骤2]
    B --> C{判断}
    C -->|是| D[步骤3]
    C -->|否| E[步骤4]
​```

**流程说明**：

1. **第一步**：{说明}
2. **第二步**：{说明}
...

---

## 五、状态流转

### 状态说明

| 状态 | 含义 | 用户看到的文字 |
|------|------|----------------|
| xxx | xxx | xxx |

### 状态流转图

​```mermaid
stateDiagram-v2
    [*] --> 待支付
    待支付 --> 已支付: 支付成功
    待支付 --> 已取消: 用户取消
​```

### 流转规则

- **规则一**：{规则描述}
- **规则二**：{规则描述}

---

## 六、业务规则汇总

| 规则编号 | 规则描述 | 适用场景 |
|----------|----------|----------|
| R001 | xxx | xxx |
| R002 | xxx | xxx |

---

## 七、变更影响分析

> 如果是变更分析任务，包含此章节

### 变更需求

> {原始需求描述}

### 影响范围

| 影响方面 | 影响程度 | 说明 |
|----------|----------|------|
| xxx | 高/中/低 | xxx |

### 详细分析

{详细的影响分析}

### 建议方案

{实施建议}

---

## 附录：技术参考

> 以下信息供技术人员参考，产品经理可跳过

### 相关代码文件

| 文件 | 说明 |
|------|------|
| xxx | xxx |

### 数据库表

| 表名 | 说明 |
|------|------|
| xxx | xxx |
```

### 快速模式文档结构

```markdown
# {模块名称} 业务梳理（快速版）

## 业务概述

{一段话描述}

## 核心业务对象

- **{对象1}**：{一句话说明}
- **{对象2}**：{一句话说明}
- **{对象3}**：{一句话说明}

## 关系图

​```mermaid
erDiagram
    用户 ||--o{ 订单 : "下单"
    订单 ||--|{ 商品明细 : "包含"
​```

## 关键规则

1. {规则1}
2. {规则2}
3. {规则3}

---

*如需详细分析，请使用标准模式*
```

## 输出示例

### 标准模式示例

```markdown
# 订单业务梳理

## 文档信息

- **整理时间**：2024年1月15日
- **整理范围**：订单相关业务

---

## 一、业务概述

订单是电商系统的核心业务对象，记录了用户的每一次购买行为。一个订单从用户下单开始，经历支付、发货、收货等环节，最终完成交易。

订单模块涉及用户、商品、支付、物流等多个业务领域的协同，是整个交易链路的核心枢纽。

---

## 二、核心业务对象

### 2.1 订单（主要业务数据）

**是什么**：订单是用户一次购买行为的完整记录，包含了"谁买的"、"买了什么"、"花了多少钱"等关键信息。

**数据粒度**：以"单次购买行为"为单位，一个用户可以有多个订单。

**关键信息**：

| 信息项 | 说明 | 示例 |
|--------|------|------|
| 订单编号 | 系统自动生成的唯一标识 | 202401150001 |
| 订单状态 | 当前订单处于什么阶段 | 待支付、已支付、已发货 |
| 订单金额 | 用户实际需要支付的金额 | 199.00元 |

**业务规则**：
- 订单编号一旦生成不可修改
- 订单金额 = 商品金额 + 运费 - 优惠金额
- 订单创建后30分钟内未支付，系统自动取消

### 2.2 订单商品明细（订单的详细内容）

**是什么**：记录一个订单里具体买了哪些商品，每个商品买了几件、单价多少。

**数据粒度**：以"订单中的单个商品"为单位，一个订单可以包含多个商品明细。

**关键信息**：

| 信息项 | 说明 | 示例 |
|--------|------|------|
| 商品名称 | 购买的商品是什么 | iPhone 15 Pro |
| 购买数量 | 买了几件 | 2 |
| 商品单价 | 每件多少钱 | 8999.00元 |

---

## 三、业务对象关系

### 关系一览图

​```mermaid
erDiagram
    用户 ||--o{ 订单 : "下单"
    订单 ||--|{ 商品明细 : "包含"
    订单 ||--o{ 状态记录 : "记录"
    商品明细 }o--|| 商品 : "购买"
​```

### 关系详细说明

**用户 与 订单**：
- 一个用户可以有多个订单
- 每个订单只属于一个用户
- 举例：张三这个月下了5个订单，每个订单都记录了"张三"这个用户

**订单 与 商品明细**：
- 一个订单可以包含多个商品
- 每个商品明细只属于一个订单
- 举例：就像超市购物小票，一张小票上可以有多行商品

...
```

### 快速模式示例

```markdown
# 订单业务梳理（快速版）

## 业务概述

订单是用户购买行为的记录，从下单到支付、发货、收货，记录了完整的交易过程。

## 核心业务对象

- **订单**：用户一次购买行为的完整记录
- **订单商品明细**：订单里具体买了哪些商品
- **订单状态记录**：订单状态每次变化的历史

## 关系图

​```mermaid
erDiagram
    用户 ||--o{ 订单 : "下单"
    订单 ||--|{ 商品明细 : "包含"
​```

## 关键规则

1. 订单创建后30分钟内未支付，系统自动取消
2. 订单金额 = 商品金额 + 运费 - 优惠金额
3. 发货后7天用户未操作，系统自动确认收货

---

*如需详细分析，请使用标准模式*
```

## 重要约束

- **统一输出** - 所有内容输出到一个文件
- **自然语言为主** - 像讲故事一样描述业务
- **避免技术术语** - 使用"信息项"而非"字段"
- **举例说明** - 用具体例子帮助理解
- **代码放附录** - 技术细节放最后

## 完成标志

- 文档已生成到指定目录
- 所有内容使用业务语言
- 向用户说明文档位置
